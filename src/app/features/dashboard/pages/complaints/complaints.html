<div class="col-12">
    <div class="card shadow-sm border-0 px-4">

        <div class="d-flex align-items-center flex-wrap py-4">

            <div class="d-flex align-items-center gap-4 flex-nowrap mt-3">
                <h5 class="mb-0 table-title">
                    {{ t('complaintsTable') }}
                    <span class="total-count p-1 rounded small bg-success text-white">
                        {{ t('total') }} {{ totalItems }}
                    </span>
                    <p class="text-muted fs-6">{{ t('complaintsOverview') }}</p>
                </h5>
            </div>

            <div class="d-flex align-items-center gap-3 flex-nowrap ms-auto">
                 <button class="btn btn-success" (click)="deleteSelected()">
          <i class="fa-regular fa-trash-can"></i> {{ t('delete') }}
        </button>
                <!-- Search -->
                <div class="search-container">
                    <input type="text"
                           [(ngModel)]="searchText"
                           (input)="fetchComplaints()"
                           [placeholder]="t('search')">
                    <i class="fas fa-search search-icon"></i>
                </div>

                <!-- Type Filter -->
                <div class="dropdown-filter">
                    <select class="form-select btn btn-outline-secondary btn-sm"
                            [(ngModel)]="filterType"
                            (change)="fetchComplaints()">
                        <option value="">{{ t('type') }}</option>
                        <option value="TECHNICAL">{{ t('technical') }}</option>
                        <option value="COMMERCIAL">{{ t('commercial') }}</option>
                    </select>
                </div>

                <!-- Date Filter Button -->
                <!-- <button class="btn btn-outline-secondary btn-sm d-flex align-items-center gap-2">
                    <i class="fas fa-calendar-alt"></i> {{ t('dateRange') }}
                </button> -->
            </div>
        </div>

        <div class="table-responsive">

            <table class="table table-hover align-middle">

                <thead class="bg-light">
                    <tr class="text-muted small text-uppercase">
                        <th style="width: 50px;"></th>
                        <th>{{ t('name') }}</th>
                        <th>{{ t('email') }}</th>
                        <th>{{ t('mobile') }}</th>
                        <th>{{ t('complaintType') }}</th>
                        <th>{{ t('message') }}</th>
                        <th>{{ t('license') }}</th>
                        <th>{{ t('date') }}</th>
                        <th>{{ t('respond') }}</th>
                        <th>{{ t('actions') }}</th>
                    </tr>
                </thead>

                <tbody>

                    <!-- Loading Spinner -->
                    <tr *ngIf="loading">
                        <td colspan="8" class="text-center py-5">
                            <div class="spinner-border"></div>
                        </td>
                    </tr>

                    <!-- Error -->
                    <tr *ngIf="!loading && errorMessage">
                        <td colspan="8" class="text-center text-danger py-4">
                            {{ errorMessage }}
                        </td>
                    </tr>

                    <!-- Table Rows -->
                    <tr *ngFor="let complaint of complaintsData"
          [class.selected-row]="complaint.selected"
    class="border-bottom complaint-row">

    <!-- البيانات -->
    <td>
<input type="checkbox" class="custom-checkbox" [(ngModel)]="complaint.selected" (click)="$event.stopPropagation()" />
    </td>
    <td class="fw-bold text-dark">{{ complaint.subscriberName }}</td>
    <td class="text-muted">{{ complaint.email }}</td>
    <td class="text-muted">{{ complaint.phone }}</td>
    <td class="text-muted">{{ complaint.type }}</td>
    <td class="text-muted">{{ complaint.message }}</td>
    <td class="text-muted">{{ complaint.subscriber?.subdomain }}</td>
    <td class="text-muted">{{ complaint.complaintDate | date: 'yyyy-MM-dd HH:mm' }}</td>
    <td class="text-muted">{{ complaint.response }}</td>
    <!-- Actions -->
    <td>
        <button class="btn btn-success btn-sm"
                (click)="openRespondModal(complaint); $event.stopPropagation()">
            {{ t('respond') }}
        </button>
    </td>
                    </tr>
                </tbody>
            </table>

            <!-- Pagination -->
            <div class="d-flex flex-wrap justify-content-between align-items-center mt-4 pb-3 px-2">

                <div class="text-muted small">
                    {{ (currentPage - 1) * itemsPerPage + 1 }} -
                    {{ Math.min(currentPage * itemsPerPage, totalItems) }}
                    {{ t('of') }} {{ totalItems }}
                </div>

                <div class="d-flex align-items-center gap-2">

                    <button class="btn btn-outline-light text-dark pagination-btn"
                            (click)="changePage(currentPage - 1)"
                            [disabled]="currentPage === 1">
                        <i class="fas fa-chevron-left small"></i> {{ t('back') }}
                    </button>

                    <div class="d-flex gap-1">
                        <ng-container *ngFor="let page of paginationArray">
                            <button *ngIf="page !== '...'"
                                    class="btn pagination-btn"
                                    [class.active]="page === currentPage"
                                    (click)="changePage(page)">
                                {{ page }}
                            </button>
                            <span *ngIf="page === '...'" class="px-2 text-muted">...</span>
                        </ng-container>
                    </div>

                    <button class="btn btn-outline-light text-dark pagination-btn"
                            (click)="changePage(currentPage + 1)"
                            [disabled]="currentPage === totalPages">
                        {{ t('next') }} <i class="fas fa-chevron-right small"></i>
                    </button>

                    <div class="d-flex align-items-center gap-2 ms-3">
                        <span class="text-muted small">{{ t('page') }}</span>
                        <input type="number" class="form-control pagination-input" [(ngModel)]="goToPageInput">
                        <button class="btn fw-bold text-dark" (click)="goToPage()">{{ t('go') }}</button>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" *ngIf="showComplaintModal" (click)="closeComplaintDetails()"></div>

<div class="custom-modal" [class.show]="showComplaintModal">
    <div class="modal-content">

        <header class="modal-header">
            <h5 class="modal-title">{{ t('complaintMessage') }}</h5>
            <button type="button" class="close-btn" (click)="closeComplaintDetails()">
                <i class="fas fa-times"></i>
            </button>
        </header>

        <div class="modal-body" *ngIf="selectedComplaint">

            <div class="detail-item">
                <span class="detail-label">{{ t('subscriberName') }}</span>
                <p class="detail-value">{{ selectedComplaint.subscriberName }}</p>
            </div>

            <div class="detail-item">
                <span class="detail-label">{{ t('date') }}</span>
                <p class="detail-value">{{ selectedComplaint.complaintDate | date:'yyyy-MM-dd HH:mm' }}</p>
            </div>

            <div class="detail-item">
                <span class="detail-label">{{ t('type') }}</span>
                <p class="detail-value">{{ selectedComplaint.type }}</p>
            </div>

            <div class="detail-item full-message">
                <span class="detail-label">{{ t('message') }}</span>
                <p class="detail-value message-text">{{ selectedComplaint.message }}</p>
            </div>
        </div>

    </div>
</div>
<div class="custom-modal" [class.show]="showRespondModal">
  <div class="modal-content">
    <header class="modal-header">
      <h5 class="modal-title">{{ t('respondToComplaint') }}</h5>
      <button type="button" class="close-btn" (click)="closeRespondModal()">
        <i class="fas fa-times"></i>
      </button>
    </header>

    <div class="modal-body" *ngIf="selectedComplaint">
      <div class="mb-3">
        <label>{{ t('yourResponse') }}</label>
        <input type="text" class="form-control" [(ngModel)]="responseText">
      </div>
      <div class="d-flex justify-content-end gap-2">
        <button class="btn btn-secondary" (click)="closeRespondModal()">{{ t('cancel') }}</button>
        <button class="btn btn-primary" (click)="sendResponse()">
          {{ t('send') }}
        </button>
      </div>
    </div>
  </div>
</div>

